# cdk8s

> Cloud Development Kit for Kubernetes

**cdk8s** is a software development framework for defining Kubernetes
applications using rich object-oriented APIs. It allows developers to leverage
the full power of software in order to define abstract components called
"constructs" which compose Kubernetes resources or other constructs into
higher-level abstractions.

This library is the foundation of **cdk8s**. It includes base types that are
used to define cdk8s applications.

## Chart

The `Chart` is a container that synthesizes a single Kubernetes manifest.

```ts
class MyChart extends Chart {
  constructor(scope: Construct, ns: string) {
    super(scope, ns);

    // add contents here
  }
}
```

During synthesis, charts collect all the `ApiObject` nodes (recursively) and
emit a single YAML manifest that includes all these objects.

## ApiObject

An `ApiObject` is a construct that represents an entry in a Kubernetes manifest.
In most cases, you won't use `ApiObject` directly but rather use classes that
are generated by the cdk8s CLI and extend this base class.


## Include

The `Include` construct can be used to include an existing manifest in a chart.

The following example will include the Kubernetes Dashboard in `MyChart`:

```ts
import { Include } from 'cdk8s';

class MyChart extends Chart {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const dashboard = new Include(this, 'dashboard', {
      url: 'https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml',
      // or
      url: 'dashboard.yaml'
    });

    // ...other resources
  }
}
```

All API objects defined in the included manifest will be added as children
`ApiObject`s under the `Include` construct's scope. This implies that you can
use `Node.of(include).children` to inspect them.

The following example queries for all the `Deployment` resources in the
dashboard:

```ts
const deps = Node.of(dashboard)
  .children
  .filter((c: ApiObject) => c.kind === 'Deployment');
```

NOTE: names of included objects (`metadata.name`) are preserved. This means that
if you try to include the same manifest twice into the same chart, your manifest
will have duplicate definitions of the same objects.

## Metadata

Kubernetes objects can have metadata such as [labels], [annotations] and
[namespaces] associated with them.

[labels]: (https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)
[annotations]: (https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)
[namespaces]: (https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/)

When an API object is defined, you can explicitly specify it's metadata. For example:

```ts
new Pod(this, 'mypod', {
  metadata: {
    namespace: 'my-app',
    labels: {
      foo: 'bar'
    }
  },
});
```

cdk8s also supports applying specific metadata at the *construct scope* using
the `Metadata` class. By applying metadata at the scope level, all API objects
defined within this sub-tree will have that metadata defined.

Use the `Metadata.of(scope)` to obtain a `Metadata` object associated with a
certain construct scope, and use the `addXxx` and `removeXxx` methods to
add/remove metadata from that scope.

For example, the following code adds the `app=my-app` label to all API objects
in all charts in an app:

```ts
const app = new App();

new MyChart(app, 'my-chart');
new YourChart(app, 'your-chart');
// ...

Metadata.of(app).addLabels({ app: 'my-app' });

app.synth();
```

The following example sets the namespace of all API objects in a custom construct:

```ts
class MyCustomConstruct extends Construct {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    Metadata.of(this).addNamespace('redis-app');

    new Pod(...);
    new Deployment(...);

    new ChildConstruct(...); // applies recursively
  }
}
```

You can also remove a label or a namespace definition from a scope (and all API
objects within that scope) using the `removeXxx` methods.

### Testing

cdk8s bundles a set of test utilities under the `Testing` class:

* `Testing.app()` returns an `App` object bound to a temporary output directory.
* `Testing.synth(chart)` returns the Kubernetes manifest synthesized from a
  chart.



## License

This project is distributed under the [Apache License, Version 2.0](./LICENSE).

This module is part of the [cdk8s project](https://github.com/awslabs/cdk8s).
